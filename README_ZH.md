<h2 align="center"><img src="./assets/imgs/image.png" style="height:1em; width:auto; vertical-align:middle"/> Lattice: LLM Agent åˆ†å¸ƒå¼æ¡†æ¶</h2>

<p align="center">
    <a href="https://github.com/dubin555/Lattice/blob/main/LICENSE">
        <img src="https://img.shields.io/badge/è®¸å¯è¯-MIT-green?style=for-the-badge" alt="License">
    </a>
</p>

<p align="center">
    ä¸­æ–‡ | <a href="./README.md">English</a>
</p>

> **æ³¨æ„**: æœ¬é¡¹ç›®åŸºäº [Maze](https://github.com/QinbinLi/Maze) æ„å»ºï¼Œå¹¶è¿›è¡Œäº†æ”¹è¿›ï¼ŒåŒ…æ‹¬å¢å¼ºçš„æ²™ç®±éš”ç¦»ã€æ›´å¥½çš„èµ„æºç®¡ç†ä»¥åŠæ‰©å±•çš„ LangGraph é›†æˆã€‚

## ğŸŒŸ ä¸ºä»€ä¹ˆé€‰æ‹© Latticeï¼Ÿ

- **ä»»åŠ¡çº§å¹¶è¡Œ**

  Lattice æ”¯æŒç»†ç²’åº¦çš„ä»»åŠ¡çº§ç®¡ç†ï¼Œå¢å¼ºç³»ç»Ÿçµæ´»æ€§å’Œå¯ç»„åˆæ€§ï¼ŒåŒæ—¶æ”¯æŒä»»åŠ¡å¹¶è¡Œä»¥æ˜¾è‘—æå‡ Agent å·¥ä½œæµçš„ç«¯åˆ°ç«¯æ€§èƒ½ã€‚

- **èµ„æºç®¡ç†**

  Lattice æ”¯æŒå·¥ä½œæµä»»åŠ¡çš„èµ„æºåˆ†é…ï¼Œæœ‰æ•ˆé˜²æ­¢å•ä¸ªå·¥ä½œæµå†…å¹¶è¡Œä»»åŠ¡ä¹‹é—´ä»¥åŠå¤šä¸ªå¹¶å‘æ‰§è¡Œå·¥ä½œæµä¹‹é—´çš„èµ„æºç«äº‰ã€‚

- **åˆ†å¸ƒå¼éƒ¨ç½²**

  Lattice ä¸ä»…æ”¯æŒå•æœºéƒ¨ç½²ï¼Œè¿˜æ”¯æŒåˆ†å¸ƒå¼éƒ¨ç½²ï¼Œè®©æ‚¨å¯ä»¥æ„å»ºé«˜å¯ç”¨ã€å¯æ‰©å±•çš„ Lattice é›†ç¾¤ï¼Œæ»¡è¶³å¤§è§„æ¨¡å¹¶å‘å’Œé«˜æ€§èƒ½è®¡ç®—çš„éœ€æ±‚ã€‚

- **æ²™ç®±æ‰§è¡Œ**

  Lattice æä¾›å¤šç§éš”ç¦»çº§åˆ«çš„å®‰å…¨ä»»åŠ¡æ‰§è¡Œç¯å¢ƒï¼ˆsubprocessã€seccompã€Dockerï¼‰ï¼Œä¿æŠ¤æ‚¨çš„ç³»ç»Ÿå…å—æ½œåœ¨æ¶æ„æˆ–æœ‰ç¼ºé™·çš„ä»»åŠ¡ä»£ç å½±å“ã€‚

- **å¤š Agent æ¡†æ¶æ”¯æŒ**

  Lattice å¯ä½œä¸ºå…¶ä»– Agent æ¡†æ¶çš„è¿è¡Œæ—¶åç«¯ã€‚ä¾‹å¦‚ï¼ŒLangGraph å¯ä»¥æ— ç¼è¿ç§»åˆ° Latticeï¼Œæ— éœ€ä¿®æ”¹åŸæœ‰é€»è¾‘å³å¯è‡ªåŠ¨è·å¾—ä»»åŠ¡çº§å¹¶è¡Œèƒ½åŠ›ã€‚

## ğŸ—ï¸ æ¶æ„

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                        Lattice Client                           â”‚
â”‚  (LatticeClient, LatticeWorkflow, @task è£…é¥°å™¨, LangGraph)       â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                              â”‚ HTTP/WebSocket
                              â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                      Lattice Server (Head)                      â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚
â”‚  â”‚ FastAPI     â”‚  â”‚ Orchestratorâ”‚  â”‚ Scheduler               â”‚  â”‚
â”‚  â”‚ (REST API)  â”‚  â”‚ (ç”Ÿå‘½å‘¨æœŸ)   â”‚  â”‚ (ä»»åŠ¡é˜Ÿåˆ— + è°ƒåº¦)        â”‚  â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”â”‚
â”‚  â”‚              Resource Manager (CPU/GPU/å†…å­˜)                 â”‚â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                              â”‚ Ray
          â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
          â–¼                   â–¼                   â–¼
   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”     â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”     â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
   â”‚   Worker 1  â”‚     â”‚   Worker 2  â”‚     â”‚   Worker N  â”‚
   â”‚  (æ‰§è¡Œå™¨)    â”‚     â”‚  (æ‰§è¡Œå™¨)    â”‚     â”‚  (æ‰§è¡Œå™¨)    â”‚
   â”‚  [æ²™ç®±]     â”‚     â”‚  [æ²™ç®±]      â”‚     â”‚  [æ²™ç®±]     â”‚
   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜     â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜     â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

## ğŸš€ å¿«é€Ÿå¼€å§‹

### 1. å®‰è£…

**ä» PyPI å®‰è£…ï¼ˆæ¨èï¼‰**

```bash
pip install lattice-agent
```

**ä»æºç å®‰è£…**

```bash
git clone https://github.com/dubin555/Lattice.git
cd Lattice
pip install -e .
```

### 2. å¯åŠ¨ Lattice

å¯åŠ¨ Lattice Head ä½œä¸ºæœåŠ¡å™¨ï¼š

```bash
lattice start --head --port 8000
```

åˆ†å¸ƒå¼éƒ¨ç½²æ—¶ï¼Œè¿æ¥ Worker èŠ‚ç‚¹ï¼š

```bash
lattice start --worker --addr HEAD_IP:HEAD_PORT
```

**å¯ç”¨æ²™ç®±ï¼ˆæ¨èç”¨äºä¸å¯ä¿¡ä»£ç ï¼‰ï¼š**

```bash
# å¯ç”¨ seccomp æ²™ç®±ï¼ˆä»… Linuxï¼Œè½»é‡çº§ï¼‰
lattice start --head --port 8000 --sandbox seccomp

# æˆ–ä½¿ç”¨ subprocess æ²™ç®±ï¼ˆè·¨å¹³å°ï¼‰
lattice start --head --port 8000 --sandbox subprocess
```

### 3. ç¤ºä¾‹

```python
from typing import Any
from lattice import LatticeClient, task

# 1. ä½¿ç”¨ @task è£…é¥°å™¨å®šä¹‰ä»»åŠ¡å‡½æ•°
@task(inputs=["text"], outputs=["result"])
def my_task(params):
    text: Any = params.get("text")
    return {"result": f"Hello {text}"}

# 2. åˆ›å»º Lattice å®¢æˆ·ç«¯
client = LatticeClient("http://localhost:8000")

# 3. åˆ›å»ºå·¥ä½œæµ
workflow = client.create_workflow()
task1 = workflow.add_task(
    my_task,
    inputs={"text": "Lattice"}
)

# 4. æäº¤å·¥ä½œæµå¹¶è·å–ç»“æœ
run_id = workflow.run()
results = workflow.get_results(run_id)
print(results)  # {'result': 'Hello Lattice'}
```

### 4. LangGraph é›†æˆ

```python
from lattice import LangGraphClient

client = LangGraphClient("http://localhost:8000")

@client.task(cpu=2, memory=4096)
def process_data(state):
    # æ‚¨çš„ LangGraph èŠ‚ç‚¹é€»è¾‘
    return {"processed": True}

# åœ¨ LangGraph å·¥ä½œæµä¸­ä½¿ç”¨
# ä»»åŠ¡è‡ªåŠ¨è·å¾—å¹¶è¡Œå’Œèµ„æºç®¡ç†èƒ½åŠ›
```

## ğŸ›¡ï¸ æ²™ç®±éš”ç¦»

Lattice æä¾›å¤šç§æ²™ç®±çº§åˆ«ç”¨äºå®‰å…¨ä»»åŠ¡æ‰§è¡Œï¼š

| çº§åˆ« | å¹³å° | éš”ç¦»æ€§ | æ€§èƒ½ |
|------|------|--------|------|
| `none` | å…¨å¹³å° | æ— éš”ç¦» | æœ€å¿« |
| `subprocess` | å…¨å¹³å° | ç‹¬ç«‹è¿›ç¨‹ + èµ„æºé™åˆ¶ | å¿« |
| `seccomp` | Linux | ç³»ç»Ÿè°ƒç”¨è¿‡æ»¤ + èµ„æºé™åˆ¶ | å¿« |
| `docker` | å…¨å¹³å°ï¼ˆéœ€å®‰è£… Dockerï¼‰ | å®Œæ•´å®¹å™¨éš”ç¦» | è¾ƒæ…¢ |

```python
# ç¨‹åºåŒ–é…ç½®æ²™ç®±
from lattice.executor.sandbox import set_sandbox_config, SandboxConfig, SandboxLevel

config = SandboxConfig(
    level=SandboxLevel.SECCOMP,
    timeout=300,
    max_memory_mb=2048,
)
set_sandbox_config(config)
```

## ğŸ§ª æµ‹è¯•

```bash
# è¿è¡Œå•å…ƒæµ‹è¯•
pytest tests/unit/ -v

# è¿è¡Œé›†æˆæµ‹è¯•ï¼ˆéœ€è¦è¿è¡Œä¸­çš„æœåŠ¡å™¨ï¼‰
lattice start --head --port 8000 &
pytest tests/integration/ -v -m integration
```

## ğŸ“ é¡¹ç›®ç»“æ„

```
lattice/
â”œâ”€â”€ api/            # FastAPI æœåŠ¡å™¨å’Œè·¯ç”±
â”œâ”€â”€ cli/            # å‘½ä»¤è¡Œæ¥å£
â”œâ”€â”€ client/         # å®¢æˆ·ç«¯ SDK (LatticeClient, LangGraphClient)
â”œâ”€â”€ core/           # æ ¸å¿ƒè¿è¡Œæ—¶ (orchestrator, scheduler, resource)
â”œâ”€â”€ executor/       # ä»»åŠ¡æ‰§è¡Œ (Ray, sandbox)
â”œâ”€â”€ llm/            # LLM å®ä¾‹ç®¡ç†
â””â”€â”€ utils/          # å·¥å…·å‡½æ•°
```

## ğŸ“„ è®¸å¯è¯

æœ¬é¡¹ç›®é‡‡ç”¨ MIT è®¸å¯è¯ - è¯¦è§ [LICENSE](LICENSE) æ–‡ä»¶ã€‚

## ğŸ¤ è´¡çŒ®

æ¬¢è¿è´¡çŒ®ï¼è¯·éšæ—¶æäº¤ Pull Requestã€‚

